

							

BEGIN TRY
    BEGIN TRANSACTION


DECLARE @MUHFISREFNO INT;
DECLARE @EVRAKNO INT;
DECLARE @EVRONTAKI VARCHAR(20);
DECLARE @MUHFISNO VARCHAR(30);
DECLARE @SiraNo INT;




    IF (SELECT COUNT(*) FROM MUHFIS WHERE MUHFISEKCHAR1='NAKIT.JHWE20013086.959')=0 BEGIN
        SELECT @MUHFISREFNO = ISNULL((SELECT MAX(MUHFISREFNO) FROM MUHFIS),0) + 1
        SELECT @EVRONTAKI = EVRONTAKI , @EVRAKNO=EVRNO  FROM EVRAKNO WHERE EVRNOMODUL=4 AND EVRSIRANO= 1;
        UPDATE EVRAKNO SET EVRNO=EVRNO +1  WHERE EVRNOMODUL=4 AND EVRSIRANO= 1;
        SET @EVRAKNO = @EVRAKNO + 1;
        IF LEN(CAST(@EVRAKNO as VARCHAR(20)))<6 BEGIN
            SET @MUHFISNO = @EVRONTAKI + '-' + SPACE(6-LEN(CAST(@EVRAKNO as VARCHAR(20)))) + CAST(@EVRAKNO as VARCHAR(20));
        END ELSE BEGIN
            SET @MUHFISNO = @EVRONTAKI + '-' + CAST(@EVRAKNO as VARCHAR(20));
        END

        INSERT INTO MUHFIS(MUHFISTAR, MUHFISNO, MUHFISCINSI, MUHFISYEVNO, MUHFISREFNO, MUHFISKAYITONC, MUHFISBORCTOP, MUHFISALACAKTOP, MUHFISDOVBORCTOP, MUHFISDOVALACAKTOP, MUHFISMASMER, MUHFISOZELKOD1, MUHFISOZELKOD2, MUHFISOZELKOD3, MUHFISOZELFLAG, MUHFISKAYNAK, MUHFISBASFLAG, MUHFISMATATEFLAG, MUHFISHAZKOD, MUHFISHAZTAR, MUHFISHAZNOT, MUHFISKONTKOD, MUHFISKONTTAR, MUHFISKONTNOT, MUHFISONAYKOD, MUHFISONAYTAR, MUHFISONAYNOT, MUHFISSEVNO, MUHFISISYKOD, MUHFISDOVTAR, MUHFISDOVKOD, MUHFISDOVTUR, MUHFISDOVKUR, MUHFISKASDOVTOP, MUHFISTRNTAR, MUHFISTRNREFNO, MUHFISTRNTIPI, MUHFISTFRSFLAG, MUHFISBELTUR, MUHFISEKCHAR1, MUHFISEKCHAR2, MUHFISEKINT1, MUHFISEKINT2, MUHFISEKTUT1, MUHFISEKTUT2)
        VALUES ('2019-01-01', @MUHFISNO, 1, 0, @MUHFISREFNO, 4, 176, 176, 0, 0, '', 'İzmit',
        'NAKİT', 'YAZARKS2', 0, 3, 0, 1, '05', '1900-01-01', '', '05', '1900-01-01', '', '', '1900-01-01', '', 1, '', '1900-01-01', '', '', 0, 0, '1900-01-01',
         0, 0, 0, 'ZRAP', 'NAKIT.JHWE20013086.959', 'Z RAPOR TAHSİLİ', 0, 0, 0, 0);


        UPDATE HARREFNO SET HARREFDEGER= @MUHFISREFNO + 1 WHERE HARREFMODUL=4 AND HARREFKONU = 1;


        INSERT INTO MUHHAR (MUHHARTAR, MUHHARREFNO, MUHHARSIRANO, MUHHARMUHKOD, MUHHARACIKLAMA, MUHHARBATIPI, MUHHARTUTAR, MUHHARDOVKOD, MUHHARDOVTUR, MUHHARDOVTUTAR, MUHHARMASMER, MUHHAREVRAKNO, MUHHAROZELKOD, MUHHARACIKLAMA1, MUHHARACIKLAMA2, MUHHARACIKLAMA3, MUHHARMIKTUT, MUHHARNO, MUHHARCINSI, MUHHARYEVNO, MUHHARKAYITONC, MUHHAROZELFLAG, MUHHARKAYNAK, MUHHARMATATEFLAG, MUHHAREKCHAR1, MUHHAREKCHAR2, MUHHAREKINT1, MUHHAREKINT2, MUHHAREKDATE1, MUHHAREKDATE2, MUHHAREKTUT1, MUHHAREKTUT2, MUHHAREKMIK1, MUHHAREKMIK2, MUHHAREKDOVTUT1, MUHHAREKDOVTUT2, MUHHAREKORAN1, MUHHAREKORAN2, MUHHARDOVKUR, MUHHAREVRAKTAR, MUHHARTFRSFLAG, MUHHARVADESİ, MUHHARVADEORAN, MUHHARVADETUTAR, MUHHARBELTUR)
        VALUES ('2019-01-01', @MUHFISREFNO, 1, '100 01 07', 'JHWE20013086-959 NO LU ZRAP FAT.İLE TL İzmit ŞUBE ,MAL SATIŞI', 1, 176,'' ,'' ,0 ,'',
        'JHWE20013086-959', '', '', '' ,'' ,0 , @MUHFISNO, 1, 0, 4, 0, 3, 1, '', '', 0, 0, '1900-01-01', '1900-01-01', 0, 0, 0, 0, 0, 0, 0, 0, 0,'2019-01-01', 0, '1900-01-01', 0, 0, 'ZRAP')

        INSERT INTO MUHHAR (MUHHARTAR, MUHHARREFNO, MUHHARSIRANO, MUHHARMUHKOD, MUHHARACIKLAMA, MUHHARBATIPI, MUHHARTUTAR, MUHHARDOVKOD, MUHHARDOVTUR, MUHHARDOVTUTAR, MUHHARMASMER, MUHHAREVRAKNO, MUHHAROZELKOD, MUHHARACIKLAMA1, MUHHARACIKLAMA2, MUHHARACIKLAMA3, MUHHARMIKTUT, MUHHARNO, MUHHARCINSI, MUHHARYEVNO, MUHHARKAYITONC, MUHHAROZELFLAG, MUHHARKAYNAK, MUHHARMATATEFLAG, MUHHAREKCHAR1, MUHHAREKCHAR2, MUHHAREKINT1, MUHHAREKINT2, MUHHAREKDATE1, MUHHAREKDATE2, MUHHAREKTUT1, MUHHAREKTUT2, MUHHAREKMIK1, MUHHAREKMIK2, MUHHAREKDOVTUT1, MUHHAREKDOVTUT2, MUHHAREKORAN1, MUHHAREKORAN2, MUHHARDOVKUR, MUHHAREVRAKTAR, MUHHARTFRSFLAG, MUHHARVADESİ, MUHHARVADEORAN, MUHHARVADETUTAR, MUHHARBELTUR)
        VALUES ('2019-01-01', @MUHFISREFNO, 2, '600 07 06', 'JHWE20013086-959 NO LU ZRAP FAT.İLE TL İzmit ŞUBE ,MAL SATIŞI', 2, 174.37,'' ,'' ,0 ,'',
        'JHWE20013086-959', '', '', '' ,'' ,0 , @MUHFISNO, 1, 0, 4, 0, 3, 1, '', '', 0, 0, '1900-01-01', '1900-01-01', 0, 0, 0, 0, 0, 0, 0, 0, 0, '2019-01-01', 0, '1900-01-01', 0, 0, 'ZRAP')

        SET @SiraNo = 2;

        

        
            set @SiraNo = @SiraNo + 1;
            INSERT INTO MUHHAR (MUHHARTAR, MUHHARREFNO, MUHHARSIRANO, MUHHARMUHKOD, MUHHARACIKLAMA, MUHHARBATIPI, MUHHARTUTAR, MUHHARDOVKOD, MUHHARDOVTUR, MUHHARDOVTUTAR, MUHHARMASMER, MUHHAREVRAKNO, MUHHAROZELKOD, MUHHARACIKLAMA1, MUHHARACIKLAMA2, MUHHARACIKLAMA3, MUHHARMIKTUT, MUHHARNO, MUHHARCINSI, MUHHARYEVNO, MUHHARKAYITONC, MUHHAROZELFLAG, MUHHARKAYNAK, MUHHARMATATEFLAG, MUHHAREKCHAR1, MUHHAREKCHAR2, MUHHAREKINT1, MUHHAREKINT2, MUHHAREKDATE1, MUHHAREKDATE2, MUHHAREKTUT1, MUHHAREKTUT2, MUHHAREKMIK1, MUHHAREKMIK2, MUHHAREKDOVTUT1, MUHHAREKDOVTUT2, MUHHAREKORAN1, MUHHAREKORAN2, MUHHARDOVKUR, MUHHAREVRAKTAR, MUHHARTFRSFLAG, MUHHARVADESİ, MUHHARVADEORAN, MUHHARVADETUTAR, MUHHARBELTUR)
            VALUES ('2019-01-01', @MUHFISREFNO, @SiraNo, '391 01', 'JHWE20013086-959 NO LU ZRAP FAT.İLE TL İzmit ŞUBE ,MAL SATIŞI', 2, 1.63,'' ,'' ,0 ,'',
            'JHWE20013086-959', '', '', '' ,'' ,0 , @MUHFISNO, 1, 0, 4, 0, 3, 1, '', '', 0, 0, '1900-01-01', '1900-01-01', 0, 0, 0, 0, 0, 0, 0, 0, 0,'2019-01-01', 0, '1900-01-01', 0, 0, 'ZRAP')
        
        
        

    END;




    IF (SELECT COUNT(*) FROM MUHFIS WHERE MUHFISEKCHAR1='KREDI.JHWE20013086.959')=0 BEGIN
        SELECT @MUHFISREFNO = ISNULL((SELECT MAX(MUHFISREFNO) FROM MUHFIS),0) + 1
        SELECT @EVRONTAKI = EVRONTAKI , @EVRAKNO=EVRNO  FROM EVRAKNO WHERE EVRNOMODUL=4 AND EVRSIRANO= 1;
        UPDATE EVRAKNO SET EVRNO=EVRNO +1  WHERE EVRNOMODUL=4 AND EVRSIRANO= 1;
        SET @EVRAKNO = @EVRAKNO + 1;
        IF LEN(CAST(@EVRAKNO as VARCHAR(20)))<6 BEGIN
            SET @MUHFISNO = @EVRONTAKI + '-' + SPACE(6-LEN(CAST(@EVRAKNO as VARCHAR(20)))) + CAST(@EVRAKNO as VARCHAR(20));
        END ELSE BEGIN
            SET @MUHFISNO = @EVRONTAKI + '-' + CAST(@EVRAKNO as VARCHAR(20));
        END

        INSERT INTO MUHFIS(MUHFISTAR, MUHFISNO, MUHFISCINSI, MUHFISYEVNO, MUHFISREFNO, MUHFISKAYITONC, MUHFISBORCTOP, MUHFISALACAKTOP, MUHFISDOVBORCTOP, MUHFISDOVALACAKTOP, MUHFISMASMER, MUHFISOZELKOD1, MUHFISOZELKOD2, MUHFISOZELKOD3, MUHFISOZELFLAG, MUHFISKAYNAK, MUHFISBASFLAG, MUHFISMATATEFLAG, MUHFISHAZKOD, MUHFISHAZTAR, MUHFISHAZNOT, MUHFISKONTKOD, MUHFISKONTTAR, MUHFISKONTNOT, MUHFISONAYKOD, MUHFISONAYTAR, MUHFISONAYNOT, MUHFISSEVNO, MUHFISISYKOD, MUHFISDOVTAR, MUHFISDOVKOD, MUHFISDOVTUR, MUHFISDOVKUR, MUHFISKASDOVTOP, MUHFISTRNTAR, MUHFISTRNREFNO, MUHFISTRNTIPI, MUHFISTFRSFLAG, MUHFISBELTUR, MUHFISEKCHAR1, MUHFISEKCHAR2, MUHFISEKINT1, MUHFISEKINT2, MUHFISEKTUT1, MUHFISEKTUT2)
        VALUES ('2019-01-01', @MUHFISNO, 1, 0, @MUHFISREFNO, 4, 340, 340, 0, 0, '', 'İzmit',
        'KREDİ', 'YAZARKS2', 0, 3, 0, 1, '05', '1900-01-01', '', '05', '1900-01-01', '', '', '1900-01-01', '', 1, '', '1900-01-01', '', '', 0, 0, '1900-01-01',
         0, 0, 0, 'ZRAP', 'KREDI.JHWE20013086.959', 'Z RAPOR TAHSİLİ', 0, 0, 0, 0);


        UPDATE HARREFNO SET HARREFDEGER= @MUHFISREFNO + 1 WHERE HARREFMODUL=4 AND HARREFKONU = 1;


        INSERT INTO MUHHAR (MUHHARTAR, MUHHARREFNO, MUHHARSIRANO, MUHHARMUHKOD, MUHHARACIKLAMA, MUHHARBATIPI, MUHHARTUTAR, MUHHARDOVKOD, MUHHARDOVTUR, MUHHARDOVTUTAR, MUHHARMASMER, MUHHAREVRAKNO, MUHHAROZELKOD, MUHHARACIKLAMA1, MUHHARACIKLAMA2, MUHHARACIKLAMA3, MUHHARMIKTUT, MUHHARNO, MUHHARCINSI, MUHHARYEVNO, MUHHARKAYITONC, MUHHAROZELFLAG, MUHHARKAYNAK, MUHHARMATATEFLAG, MUHHAREKCHAR1, MUHHAREKCHAR2, MUHHAREKINT1, MUHHAREKINT2, MUHHAREKDATE1, MUHHAREKDATE2, MUHHAREKTUT1, MUHHAREKTUT2, MUHHAREKMIK1, MUHHAREKMIK2, MUHHAREKDOVTUT1, MUHHAREKDOVTUT2, MUHHAREKORAN1, MUHHAREKORAN2, MUHHARDOVKUR, MUHHAREVRAKTAR, MUHHARTFRSFLAG, MUHHARVADESİ, MUHHARVADEORAN, MUHHARVADETUTAR, MUHHARBELTUR)
        VALUES ('2019-01-01', @MUHFISREFNO, 1, '108 01 01', 'JHWE20013086-959 NO LU ZRAP FAT.İLE TL İzmit ŞUBE ,MAL SATIŞI', 1, 340,'' ,'' ,0 ,'',
        'JHWE20013086-959', '', '', '' ,'' ,0 , @MUHFISNO, 1, 0, 4, 0, 3, 1, '', '', 0, 0, '1900-01-01', '1900-01-01', 0, 0, 0, 0, 0, 0, 0, 0, 0,'2019-01-01', 0, '1900-01-01', 0, 0, 'ZRAP')

        INSERT INTO MUHHAR (MUHHARTAR, MUHHARREFNO, MUHHARSIRANO, MUHHARMUHKOD, MUHHARACIKLAMA, MUHHARBATIPI, MUHHARTUTAR, MUHHARDOVKOD, MUHHARDOVTUR, MUHHARDOVTUTAR, MUHHARMASMER, MUHHAREVRAKNO, MUHHAROZELKOD, MUHHARACIKLAMA1, MUHHARACIKLAMA2, MUHHARACIKLAMA3, MUHHARMIKTUT, MUHHARNO, MUHHARCINSI, MUHHARYEVNO, MUHHARKAYITONC, MUHHAROZELFLAG, MUHHARKAYNAK, MUHHARMATATEFLAG, MUHHAREKCHAR1, MUHHAREKCHAR2, MUHHAREKINT1, MUHHAREKINT2, MUHHAREKDATE1, MUHHAREKDATE2, MUHHAREKTUT1, MUHHAREKTUT2, MUHHAREKMIK1, MUHHAREKMIK2, MUHHAREKDOVTUT1, MUHHAREKDOVTUT2, MUHHAREKORAN1, MUHHAREKORAN2, MUHHARDOVKUR, MUHHAREVRAKTAR, MUHHARTFRSFLAG, MUHHARVADESİ, MUHHARVADEORAN, MUHHARVADETUTAR, MUHHARBELTUR)
        VALUES ('2019-01-01', @MUHFISREFNO, 2, '600 07 06', 'JHWE20013086-959 NO LU ZRAP FAT.İLE TL İzmit ŞUBE ,MAL SATIŞI', 2, 336.8525,'' ,'' ,0 ,'',
        'JHWE20013086-959', '', '', '' ,'' ,0 , @MUHFISNO, 1, 0, 4, 0, 3, 1, '', '', 0, 0, '1900-01-01', '1900-01-01', 0, 0, 0, 0, 0, 0, 0, 0, 0, '2019-01-01', 0, '1900-01-01', 0, 0, 'ZRAP')

        SET @SiraNo = 2;
        
        
            set @SiraNo = @SiraNo + 1;
            INSERT INTO MUHHAR (MUHHARTAR, MUHHARREFNO, MUHHARSIRANO, MUHHARMUHKOD, MUHHARACIKLAMA, MUHHARBATIPI, MUHHARTUTAR, MUHHARDOVKOD, MUHHARDOVTUR, MUHHARDOVTUTAR, MUHHARMASMER, MUHHAREVRAKNO, MUHHAROZELKOD, MUHHARACIKLAMA1, MUHHARACIKLAMA2, MUHHARACIKLAMA3, MUHHARMIKTUT, MUHHARNO, MUHHARCINSI, MUHHARYEVNO, MUHHARKAYITONC, MUHHAROZELFLAG, MUHHARKAYNAK, MUHHARMATATEFLAG, MUHHAREKCHAR1, MUHHAREKCHAR2, MUHHAREKINT1, MUHHAREKINT2, MUHHAREKDATE1, MUHHAREKDATE2, MUHHAREKTUT1, MUHHAREKTUT2, MUHHAREKMIK1, MUHHAREKMIK2, MUHHAREKDOVTUT1, MUHHAREKDOVTUT2, MUHHAREKORAN1, MUHHAREKORAN2, MUHHARDOVKUR, MUHHAREVRAKTAR, MUHHARTFRSFLAG, MUHHARVADESİ, MUHHARVADEORAN, MUHHARVADETUTAR, MUHHARBELTUR)
            VALUES ('2019-01-01', @MUHFISREFNO, @SiraNo, '391 01', 'JHWE20013086-959 NO LU ZRAP FAT.İLE TL İzmit ŞUBE ,MAL SATIŞI', 2, 3.1475,'' ,'' ,0 ,'',
            'JHWE20013086-959', '', '', '' ,'' ,0 , @MUHFISNO, 1, 0, 4, 0, 3, 1, '', '', 0, 0, '1900-01-01', '1900-01-01', 0, 0, 0, 0, 0, 0, 0, 0, 0,'2019-01-01', 0, '1900-01-01', 0, 0, 'ZRAP')
        
        
        

    END;




    COMMIT TRAN
END TRY
BEGIN CATCH
    IF @@TRANCOUNT > 0
        ROLLBACK TRAN

    RAISERROR('SQL HATASI', 16, 1);
END CATCH